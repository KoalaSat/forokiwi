"use strict";(self.webpackChunkforokiwi=self.webpackChunkforokiwi||[]).push([[425],{7425:(e,n,s)=>{s.r(n),s.d(n,{Forum:()=>G});var l=s(9900),i=s(7170),t=s(1645),a=s(7419),d=s(481),r=s(8125),o=s(5010),c=s(7021),u=s(9288),h=s(9472),v=s(2245),x=s(1667),p=s(4659),j=s(6520),g=s(7385),A=s(3344),f=s(518),m=s(4738),y=s(630),w=s(5448),b=s(9092),k=s(2393),S=s(3007),T=s(8639),E=s(6971),R=s(5043),C=s(1690),V=s(2691),$=s(1875),_=s(9997),L=s(7763),M=s(7764),O=s(9360),F=s(2595),I=s(579);const{Text:z,Title:B,Link:P}=l.A,G=()=>{var e,n;const{topicLanguage:s,setTopicLanguage:l}=(0,R.useContext)(L.BR),{turtleMode:G}=(0,R.useContext)(L.BR),{ndk:N,authors:H,saveAuthors:Q,comments:U,saveComments:W,reactions:D,saveReactions:Z,saveTopics:q,saveForums:J,forums:K,getBaseRelays:X}=(0,R.useContext)(C.gH),{token:{colorBgContainer:Y,borderRadiusLG:ee}}=i.A.useToken(),{naddr:ne}=(0,E.g)(),{t:se}=(0,b.B)(),le=(0,E.Zp)(),[ie,te]=(0,R.useState)(),[ae,de]=(0,R.useState)(),[re,oe]=(0,R.useState)(),[ce,ue]=(0,R.useState)(),[he,ve]=(0,R.useState)(),[xe,pe]=(0,R.useState)(),[je,ge]=(0,R.useState)(!0),[Ae,fe]=(0,R.useState)(!0),[me,ye]=(0,R.useState)(!0),[we,be]=(0,R.useState)(!0),[ke,Se]=(0,R.useState)(!0),[Te,Ee]=(0,R.useState)(!0),[Re,Ce]=(0,R.useState)(!0),[Ve,$e]=(0,R.useState)(1),_e=(0,R.useMemo)((()=>new Array(10).fill(new V.QB)),[]),Le=[{dataIndex:"content",render:(e,n,s)=>{var l,i,r,o,c,u,h,v,x;const j=(0,k.S)(parseInt(null!==(l=null!==(i=n.tagValue("published_at"))&&void 0!==i?i:null===(r=n.created_at)||void 0===r?void 0:r.toString())&&void 0!==l?l:"0",10)),g=(0,S.m)(j,{addSuffix:!0}),A=null===H||void 0===H?void 0:H[n.pubkey],f=je&&!xe;return(0,I.jsx)(t.A,{span:24,children:(0,I.jsxs)(a.A,{children:[(0,I.jsx)(t.A,{xs:0,md:3,style:{maxWidth:40},children:(0,I.jsx)(a.A,{align:"middle",children:(0,I.jsx)(p.A,{})})}),(0,I.jsxs)(t.A,{xs:24,md:21,children:[(0,I.jsx)(a.A,{children:(0,I.jsx)(t.A,{span:24,children:(0,I.jsx)(d.A,{loading:!n.tagValue("title")&&!n.tagValue("d")||f,active:!0,paragraph:{rows:1,style:{margin:0}},title:!1,children:(0,I.jsx)(z,{strong:!0,children:null!==(o=null!==(c=n.tagValue("title"))&&void 0!==c?c:n.tagValue("d"))&&void 0!==o?o:"-"})})})}),(0,I.jsx)(a.A,{children:(0,I.jsx)(t.A,{span:24,children:(0,I.jsxs)(d.A,{loading:me||f,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:8}},title:!1,children:[(0,I.jsx)(t.A,{xs:0,md:24,children:(0,I.jsx)(z,{type:"secondary",children:`@${null!==(u=null!==(h=null===A||void 0===A?void 0:A.displayName)&&void 0!==h?h:null===A||void 0===A?void 0:A.name)&&void 0!==u?u:se("shared.events.anonymous")} - ${se("shared.events.published_at",{date:g})}`})}),(0,I.jsx)(t.A,{xs:24,md:0,children:(0,I.jsx)(z,{type:"secondary",children:`@${null!==(v=null!==(x=null===A||void 0===A?void 0:A.displayName)&&void 0!==x?x:null===A||void 0===A?void 0:A.name)&&void 0!==v?v:se("shared.events.anonymous")} - ${(0,T.GP)(j,"yy/MM/dd")}`})})]})})})]})]})})}},{dataIndex:"likes",width:15,render:(e,n,s)=>{var l,i,r,o;if(G)return(0,I.jsx)(I.Fragment,{});const c=je&&!xe;return(0,I.jsx)(a.A,{children:(0,I.jsxs)(t.A,{span:24,children:[(0,I.jsx)(a.A,{justify:"center",children:(0,I.jsx)(j.A,{})}),(0,I.jsx)(a.A,{justify:"center",children:(0,I.jsx)(d.A,{loading:!D[null!==(l=null===n||void 0===n?void 0:n.dTag)&&void 0!==l?l:""]&&ke||c,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:6},width:25},title:!1,children:null!==(i=null===(r=D[null!==(o=null===n||void 0===n?void 0:n.dTag)&&void 0!==o?o:""])||void 0===r?void 0:r.length)&&void 0!==i?i:0})})]})})}},{dataIndex:"count",width:15,render:(e,n,s)=>{var l,i,r,o;if(G)return(0,I.jsx)(I.Fragment,{});const c=je&&!xe;return(0,I.jsx)(a.A,{justify:"space-between",children:(0,I.jsxs)(t.A,{span:24,children:[(0,I.jsx)(a.A,{justify:"center",children:(0,I.jsx)(x.A,{})}),(0,I.jsx)(a.A,{justify:"center",children:(0,I.jsx)(d.A,{loading:!U[null!==(l=null===n||void 0===n?void 0:n.dTag)&&void 0!==l?l:""]&&we||c,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:6},width:25},title:!1,children:null!==(i=null===(r=U[null!==(o=null===n||void 0===n?void 0:n.dTag)&&void 0!==o?o:""])||void 0===r?void 0:r.length)&&void 0!==i?i:0})})]})})}}];(0,R.useEffect)((()=>(ne&&"all"!==ne&&(K[ne]&&te(K[ne]),N.fetchEvent(ne,{closeOnEose:!0},Me()).then((e=>{null!==e&&void 0!==e&&e.dTag&&(te(e),J({[ne]:e,[e.dTag]:e}))}))),()=>{te(void 0)})),[]),(0,R.useEffect)((()=>{Fe()}),[Ve]),(0,R.useEffect)((()=>{var e,n;ie?(de(null!==(e=null===ie||void 0===ie?void 0:ie.tagValue("name"))&&void 0!==e?e:ie.tagValue("d")),oe(null!==(n=null===ie||void 0===ie?void 0:ie.tagValue("description"))&&void 0!==n?n:""),Oe(),Ie()):"all"===ne&&(de(se("pages.forums.list.all.name")),oe(se("pages.forums.list.all.description")),ge(!1))}),[ie]);const Me=()=>{const e=X();return null===ie||void 0===ie||ie.onRelays.forEach((n=>e.push(n.url))),V.P0.fromRelayUrls(e,N,!0)},Oe=()=>{G||(Ee(!0),ie?N.fetchEvents({kinds:[1],"#a":[ie.tagReference()[1]],limit:10},{closeOnEose:!0},Me()).then((e=>{const n=[...e].map((e=>e.tags.find((e=>"a"===e[0]&&e[1].startsWith("30023:"))))),s=n.map((e=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e[1].split(":"))||void 0===s?void 0:s[2])&&void 0!==n?n:""})),l=Array.from(new Set(s));N.fetchEvents({kinds:[30023],"#d":l,"#a":[ie.tagReference()[1]]},{},Me()).then((e=>{ve(e),Ee(!1),q([...e].reduce(((e,n)=>(n.dTag&&(e[n.encode()]=n),e)),{}))}))})):Ee(!1))},Fe=e=>{fe(!0),ye(!0),be(!0),Se(!0);let n={kinds:[30023],limit:10};if(ce&&!e){var l,i;const e=Array.from(ce),s=null!==(l=null===(i=e[e.length-1])||void 0===i?void 0:i.created_at)&&void 0!==l?l:0;n.until=s+1}if(ne&&"all"!==ne){var t;const e=F.Qe.decode(ne).data;n={...n,"#a":[null!==(t=null===ie||void 0===ie?void 0:ie.tagReference()[1])&&void 0!==t?t:`34550:${e.pubkey}:${e.identifier}`]}}e?"all"!==e&&(n={...n,"#l":[(null!==s&&void 0!==s?s:e).split("-")[0]]}):"all"!==s&&(n={...n,"#l":[(null!==s&&void 0!==s?s:e).split("-")[0]]}),N.fetchEvents(n,{closeOnEose:!0},Me()).then((n=>{ue((s=>new Set(e?n:[...null!==s&&void 0!==s?s:[],...n]))),q([...n].reduce(((e,n)=>(n.dTag&&(e[n.encode()]=n),e)),{})),ze(n),fe(!1)})).catch((()=>{fe(!1),ue(new Set)}))},Ie=()=>{if(ie){Ce(!0);const e=ie.getMatchingTags("p");if(e.length>0){ge(!0);const n=e.map((e=>e[1]));G?Ce(!1):N.fetchEvents({kinds:[0],authors:n},{closeOnEose:!0,groupable:!0},Me()).then((e=>{const n={};e.forEach((e=>{n[e.pubkey]=(0,V.o_)(e)})),Q(n),Ce(!1)})),N.fetchEvents({kinds:[4550],authors:n},{closeOnEose:!0},Me()).then((e=>{const n=[];e&&[...e].forEach((e=>{const s=e.getMatchingTags("a");s[1]&&n.push(s[1])})),pe(n)})).catch((()=>pe([])))}else ge(!1)}},ze=e=>{const n=[];n.length>0?N.fetchEvents({kinds:[0],authors:n},{closeOnEose:!0,groupable:!0},Me()).then((e=>{const n={};e.forEach((e=>{n[e.pubkey]=(0,V.o_)(e)})),Q(n),ye(!1)})):ye(!1),G||e.forEach((e=>{var n;const s=null===(n=e.dTag)||void 0===n?void 0:n.toString();s&&N.fetchEvents({kinds:[1,7],"#a":[`30023:${e.pubkey}:${s}`]},{groupable:!0},Me()).then((e=>{const n=[],l=[];e.forEach((e=>{switch(e.kind){case 1:n.push(e);break;case 7:l.push(e)}})),W({[s]:n}),Z({[s]:l}),Se(!1),be(!1)}))}))};return(0,I.jsx)(w.UC,{children:(0,I.jsxs)(a.A,{justify:"space-between",gutter:[0,10],children:[(0,I.jsx)(t.A,{xs:24,md:16,children:(0,I.jsxs)(a.A,{gutter:[0,10],children:[(0,I.jsx)(t.A,{span:24,children:(0,I.jsxs)(a.A,{justify:"space-between",children:[(0,I.jsx)(r.A,{items:[{title:(0,I.jsx)("a",{children:"Home"}),onClick:()=>le("/")},{title:null!==ae&&void 0!==ae?ae:(0,I.jsx)(d.A,{paragraph:{rows:1,style:{marginTop:0}},title:!1})}]}),(0,I.jsxs)(t.A,{children:["all"===s?(0,I.jsx)(f.A,{style:{fontSize:16,marginRight:10}}):(0,I.jsx)(O.A,{countryCode:s.split("-")[1],style:{fontSize:16,marginRight:10}}),(0,I.jsx)(o.A,{showSearch:!0,style:{width:100},size:"small",onChange:e=>{l(e),Fe(e)},defaultValue:s,filterOption:(e,n)=>{var s;return(null!==(s=null===n||void 0===n?void 0:n.label)&&void 0!==s?s:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"all",label:se("shared.all")},...M.e.filter(((e,n,s)=>n===s.findIndex((n=>n.label===e.label)))).map((e=>({...e,label:se(`language.${e.label}`)})))]})]})]})}),(0,I.jsx)(t.A,{span:"24",children:(0,I.jsx)(w.Ay,{style:{background:Y,borderTopLeftRadius:ee,borderTopRightRadius:ee,paddingBottom:15},children:(0,I.jsxs)(a.A,{justify:"space-between",align:"middle",children:[(0,I.jsx)(t.A,{span:"1"}),(0,I.jsx)(t.A,{span:"16",children:(0,I.jsxs)(d.A,{active:!0,loading:!ae&&!re,paragraph:{rows:1},style:{marginTop:26},children:[(0,I.jsx)(a.A,{children:(0,I.jsx)(B,{children:ae})}),(0,I.jsx)(a.A,{children:(0,I.jsx)(z,{type:"secondary",children:re})})]})}),(0,I.jsx)(t.A,{xs:0,md:4,children:(0,I.jsx)(a.A,{justify:"end",children:(0,I.jsx)(c.Ay,{type:"primary",htmlType:"submit",size:"large",icon:(0,I.jsx)(g.A,{}),iconPosition:"end",onClick:()=>le(`/forum/${ne}/new`),children:(0,I.jsx)(t.A,{xs:0,md:20,children:se("pages.forum.createTopic")})})})}),(0,I.jsx)(t.A,{span:"1"})]})})}),(0,I.jsx)(t.A,{span:"24",children:(0,I.jsx)(w.Ay,{style:{background:Y,borderRadius:ee},children:(0,I.jsx)(u.A,{pagination:!1,columns:Le,dataSource:Ae||je&&!xe?_e:[...null!==ce&&void 0!==ce?ce:[]].filter((e=>{var n;return!je||(null===xe||void 0===xe?void 0:xe.includes(null!==(n=e.dTag)&&void 0!==n?n:""))})).slice(10*(Ve-1),10*Ve),onRow:(e,n)=>({onClick:()=>le(`/topic/${e.encode()}`)})})})}),(0,I.jsx)(t.A,{span:"24",children:(0,I.jsxs)(a.A,{justify:"space-between",children:[(0,I.jsx)(c.Ay,{type:"link",disabled:Ve<2,onClick:()=>$e((e=>e-1)),children:se("shared.previous")}),(0,I.jsx)(c.Ay,{type:"link",children:Ve}),(0,I.jsx)(c.Ay,{type:"link",disabled:(null!==(e=null===ce||void 0===ce?void 0:ce.size)&&void 0!==e?e:1/0)<10*Ve,onClick:()=>$e((e=>e+1)),children:se("shared.next")})]})})]})}),(0,I.jsx)(t.A,{xs:24,md:7,children:(0,I.jsxs)(a.A,{gutter:[0,10],style:{marginTop:32},children:[(0,I.jsx)(t.A,{xs:0,md:24,children:(0,I.jsx)($.G,{})}),(0,I.jsx)(t.A,{xs:0,md:24,children:(0,I.jsx)(_.O,{})}),(0,I.jsx)(t.A,{span:24,children:!G&&"all"!==ne&&(0,I.jsxs)(w.Ay,{style:{padding:"24px 0",background:Y,borderRadius:ee},children:[(0,I.jsx)(a.A,{justify:"space-around",children:(0,I.jsx)(t.A,{span:"16",children:(0,I.jsxs)(B,{level:2,children:[(0,I.jsx)(m.A,{}),se("pages.forum.hotRopics")]})})}),(0,I.jsx)(a.A,{justify:"space-around",children:(0,I.jsx)(t.A,{span:"16",children:(0,I.jsxs)(d.A,{active:!0,loading:Te,title:!1,paragraph:{rows:5},children:[[...null!==he&&void 0!==he?he:[]].map(((e,n)=>{var s,l,i,d,r;return e.tagValue("title")?(0,I.jsxs)(a.A,{justify:"space-between",onClick:()=>le(`/topic/${e.encode()}`),children:[(0,I.jsx)(t.A,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:(0,I.jsx)(P,{strong:!0,children:null!==(s=null!==(l=e.tagValue("title"))&&void 0!==l?l:e.tagValue("d"))&&void 0!==s?s:"-"})}),(0,I.jsx)(t.A,{children:(0,I.jsx)(z,{children:(0,S.m)((0,k.S)(parseInt(null!==(i=null!==(d=null===e||void 0===e?void 0:e.tagValue("published_at"))&&void 0!==d?d:null===e||void 0===e||null===(r=e.created_at)||void 0===r?void 0:r.toString())&&void 0!==i?i:"0",10)),{addSuffix:!0})})})]},n):(0,I.jsx)(I.Fragment,{})})),0===(null===he||void 0===he?void 0:he.size)?(0,I.jsx)(h.A,{image:h.A.PRESENTED_IMAGE_SIMPLE}):(0,I.jsx)(I.Fragment,{})]})})})]})}),(0,I.jsx)(t.A,{span:24,children:!G&&"all"!==ne&&(0,I.jsxs)(w.Ay,{style:{padding:"24px 0",background:Y,borderRadius:ee},children:[(0,I.jsx)(a.A,{justify:"space-around",children:(0,I.jsx)(t.A,{span:"16",children:(0,I.jsxs)(B,{level:2,children:[(0,I.jsx)(y.A,{}),se("pages.forum.moderators")]})})}),(0,I.jsx)(a.A,{justify:"space-around",children:(0,I.jsx)(t.A,{span:"16",children:(0,I.jsxs)(d.A,{active:!0,loading:!ie&&Re,title:!1,paragraph:{rows:3},children:[[...null!==(n=null===ie||void 0===ie?void 0:ie.getMatchingTags("p"))&&void 0!==n?n:[]].map(((e,n)=>{var s,l;if(!e[1])return(0,I.jsx)(I.Fragment,{});const i=H[e[1]],d=new V.VT({hexpubkey:e[1]});return(0,I.jsx)(a.A,{justify:"space-between",children:(0,I.jsxs)(t.A,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[(0,I.jsx)(v.A,{src:null===i||void 0===i?void 0:i.image,icon:(0,I.jsx)(A.A,{style:{fontSize:"20px"}})}),(0,I.jsx)(P,{strong:!0,href:`https://njump.me/${d.npub}`,target:"_blank",style:{marginLeft:5},children:null!==(s=null!==(l=null===i||void 0===i?void 0:i.name)&&void 0!==l?l:e[1])&&void 0!==s?s:"-"})]})},n)})),je?(0,I.jsx)(I.Fragment,{}):(0,I.jsx)(z,{strong:!0,style:{marginLeft:5},children:se("pages.forum.noModerators")})]})})})]})})]})})]})})}}}]);
//# sourceMappingURL=425.e01170b0.chunk.js.map