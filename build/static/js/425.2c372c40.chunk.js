"use strict";(self.webpackChunkforokiwi=self.webpackChunkforokiwi||[]).push([[425],{7425:(e,n,s)=>{s.r(n),s.d(n,{Forum:()=>I});var i=s(9900),l=s(7170),t=s(1645),d=s(7419),a=s(481),r=s(8125),o=s(7021),c=s(9288),u=s(9472),h=s(2245),v=s(1667),x=s(4659),p=s(6520),j=s(7385),g=s(3344),A=s(4738),m=s(630),f=s(5448),y=s(9092),k=s(2393),w=s(3007),b=s(8639),S=s(6971),T=s(5043),E=s(1690),C=s(2691),R=s(1875),V=s(1144),_=s(7763),M=s(579);const{Text:$,Title:O,Link:F}=i.A,I=()=>{var e,n;const{turtleMode:s}=(0,T.useContext)(_.BR),{ndk:i,authors:I,saveAuthors:L,comments:z,saveComments:B,reactions:G,saveReactions:P,saveTopics:N,saveForums:H,forums:W}=(0,T.useContext)(E.gH),{token:{colorBgContainer:D,borderRadiusLG:Q}}=l.A.useToken(),{naddr:U}=(0,S.g)(),{t:Y}=(0,y.B)(),Z=(0,S.Zp)(),[q,J]=(0,T.useState)(),[K,X]=(0,T.useState)(),[ee,ne]=(0,T.useState)(),[se,ie]=(0,T.useState)(),[le,te]=(0,T.useState)(),[de,ae]=(0,T.useState)(),[re,oe]=(0,T.useState)(!0),[ce,ue]=(0,T.useState)(!0),[he,ve]=(0,T.useState)(!0),[xe,pe]=(0,T.useState)(!0),[je,ge]=(0,T.useState)(!0),[Ae,me]=(0,T.useState)(!0),[fe,ye]=(0,T.useState)(!0),[ke,we]=(0,T.useState)(1),be=(0,T.useMemo)((()=>new Array(10).fill(new C.QB)),[]),Se=[{dataIndex:"content",render:(e,n,s)=>{var i,l,r,o,c,u,h,v,p;const j=(0,k.S)(parseInt(null!==(i=null!==(l=n.tagValue("published_at"))&&void 0!==l?l:null===(r=n.created_at)||void 0===r?void 0:r.toString())&&void 0!==i?i:"0",10)),g=(0,w.m)(j,{addSuffix:!0}),A=null===I||void 0===I?void 0:I[n.pubkey],m=re&&!de;return(0,M.jsx)(t.A,{span:24,children:(0,M.jsxs)(d.A,{children:[(0,M.jsx)(t.A,{xs:0,md:3,style:{maxWidth:40},children:(0,M.jsx)(d.A,{align:"middle",children:(0,M.jsx)(x.A,{})})}),(0,M.jsxs)(t.A,{xs:24,md:21,children:[(0,M.jsx)(d.A,{children:(0,M.jsx)(t.A,{span:24,children:(0,M.jsx)(a.A,{loading:!n.tagValue("title")&&!n.tagValue("d")||m,active:!0,paragraph:{rows:1,style:{margin:0}},title:!1,children:(0,M.jsx)($,{strong:!0,children:null!==(o=null!==(c=n.tagValue("title"))&&void 0!==c?c:n.tagValue("d"))&&void 0!==o?o:"-"})})})}),(0,M.jsx)(d.A,{children:(0,M.jsx)(t.A,{span:24,children:(0,M.jsxs)(a.A,{loading:he||m,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:8}},title:!1,children:[(0,M.jsx)(t.A,{xs:0,md:24,children:(0,M.jsx)($,{type:"secondary",children:`@${null!==(u=null!==(h=null===A||void 0===A?void 0:A.displayName)&&void 0!==h?h:null===A||void 0===A?void 0:A.name)&&void 0!==u?u:Y("shared.events.anonymous")} - ${Y("shared.events.published_at",{date:g})}`})}),(0,M.jsx)(t.A,{xs:24,md:0,children:(0,M.jsx)($,{type:"secondary",children:`@${null!==(v=null!==(p=null===A||void 0===A?void 0:A.displayName)&&void 0!==p?p:null===A||void 0===A?void 0:A.name)&&void 0!==v?v:Y("shared.events.anonymous")} - ${(0,b.GP)(j,"yy/MM/dd")}`})})]})})})]})]})})}},{dataIndex:"likes",width:15,render:(e,n,i)=>{var l,r,o,c;if(s)return(0,M.jsx)(M.Fragment,{});const u=re&&!de;return(0,M.jsx)(d.A,{children:(0,M.jsxs)(t.A,{span:24,children:[(0,M.jsx)(d.A,{justify:"center",children:(0,M.jsx)(p.A,{})}),(0,M.jsx)(d.A,{justify:"center",children:(0,M.jsx)(a.A,{loading:!G[null!==(l=null===n||void 0===n?void 0:n.dTag)&&void 0!==l?l:""]&&je||u,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:6},width:25},title:!1,children:null!==(r=null===(o=G[null!==(c=null===n||void 0===n?void 0:n.dTag)&&void 0!==c?c:""])||void 0===o?void 0:o.length)&&void 0!==r?r:0})})]})})}},{dataIndex:"count",width:15,render:(e,n,i)=>{var l,r,o,c;if(s)return(0,M.jsx)(M.Fragment,{});const u=re&&!de;return(0,M.jsx)(d.A,{justify:"space-between",children:(0,M.jsxs)(t.A,{span:24,children:[(0,M.jsx)(d.A,{justify:"center",children:(0,M.jsx)(v.A,{})}),(0,M.jsx)(d.A,{justify:"center",children:(0,M.jsx)(a.A,{loading:!z[null!==(l=null===n||void 0===n?void 0:n.dTag)&&void 0!==l?l:""]&&xe||u,active:!0,paragraph:{rows:1,style:{margin:0,marginTop:6},width:25},title:!1,children:null!==(r=null===(o=z[null!==(c=null===n||void 0===n?void 0:n.dTag)&&void 0!==c?c:""])||void 0===o?void 0:o.length)&&void 0!==r?r:0})})]})})}}];(0,T.useEffect)((()=>(U&&"all"!==U&&(W[U]&&J(W[U]),i.fetchEvent(U,{closeOnEose:!0}).then((e=>{null!==e&&void 0!==e&&e.dTag&&(J(e),H({[U]:e,[e.dTag]:e}))}))),()=>{J(void 0)})),[]),(0,T.useEffect)((()=>{Ee()}),[ke]),(0,T.useEffect)((()=>{var e,n;q?(X(null!==(e=null===q||void 0===q?void 0:q.tagValue("name"))&&void 0!==e?e:q.tagValue("d")),ne(null!==(n=null===q||void 0===q?void 0:q.tagValue("description"))&&void 0!==n?n:""),Te(),Ce()):"all"===U&&(X(Y("pages.forums.list.all.name")),ne(Y("pages.forums.list.all.description")),oe(!1))}),[q]);const Te=()=>{s||(me(!0),q?i.fetchEvents({kinds:[1],"#a":[q.tagReference()[1]],limit:10},{closeOnEose:!0}).then((e=>{const n=[...e].map((e=>e.tags.find((e=>"a"===e[0]&&e[1].startsWith("30023:"))))),s=n.map((e=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e[1].split(":"))||void 0===s?void 0:s[2])&&void 0!==n?n:""})),l=Array.from(new Set(s));i.fetchEvents({kinds:[30023],"#d":l}).then((e=>{te(e),me(!1),N([...e].reduce(((e,n)=>(n.dTag&&(e[n.encode()]=n),e)),{}))}))})):me(!1))},Ee=()=>{var e;if(ue(!0),ve(!0),pe(!0),ge(!0),10*ke>(null!==(e=null===se||void 0===se?void 0:se.size)&&void 0!==e?e:0)){let e={kinds:[30023],limit:10};if(se){var n,s;const i=Array.from(se),l=null!==(n=null===(s=i[i.length-1])||void 0===s?void 0:s.created_at)&&void 0!==n?n:0;e.until=l+1}U&&(e={...e,...(0,C.bY)(U)}),i.fetchEvents(e,{closeOnEose:!0}).then((e=>{ie((n=>new Set([...null!==n&&void 0!==n?n:[],...e]))),N([...e].reduce(((e,n)=>(n.dTag&&(e[n.encode()]=n),e)),{})),Re(e),ue(!1)})).catch((()=>{ue(!1),ie(new Set)}))}else ue(!1),ve(!1),pe(!1),ge(!1)},Ce=()=>{if(q){ye(!0);const e=q.getMatchingTags("p");if(e.length>0){oe(!0);const n=e.map((e=>e[1]));s?ye(!1):i.fetchEvents({kinds:[0],authors:n},{closeOnEose:!0,groupable:!0}).then((e=>{const n={};e.forEach((e=>{n[e.pubkey]=(0,C.o_)(e)})),L(n),ye(!1)})),i.fetchEvents({kinds:[4550],authors:n},{closeOnEose:!0}).then((e=>{const n=[];e&&[...e].forEach((e=>{const s=e.getMatchingTags("a");s[1]&&n.push(s[1])})),ae(n)})).catch((()=>ae([])))}else oe(!1)}},Re=e=>{const n=[];n.length>0?i.fetchEvents({kinds:[0],authors:n},{closeOnEose:!0,groupable:!0}).then((e=>{const n={};e.forEach((e=>{n[e.pubkey]=(0,C.o_)(e)})),L(n),ve(!1)})):ve(!1),s||e.forEach((e=>{var n;const s=null===(n=e.dTag)||void 0===n?void 0:n.toString();s&&i.fetchEvents({kinds:[1,7],"#a":[`30023:${e.pubkey}:${s}`]},{groupable:!0}).then((e=>{const n=[],i=[];e.forEach((e=>{switch(e.kind){case 1:n.push(e);break;case 7:i.push(e)}})),B({[s]:n}),P({[s]:i}),ge(!1),pe(!1)}))}))};return(0,M.jsx)(f.UC,{children:(0,M.jsxs)(d.A,{justify:"space-between",gutter:[0,10],children:[(0,M.jsx)(t.A,{xs:24,md:16,children:(0,M.jsxs)(d.A,{gutter:[0,10],children:[(0,M.jsx)(t.A,{span:24,children:(0,M.jsx)(d.A,{children:(0,M.jsx)(r.A,{items:[{title:(0,M.jsx)("a",{children:"Home"}),onClick:()=>Z("/")},{title:null!==K&&void 0!==K?K:(0,M.jsx)(a.A,{paragraph:{rows:1,style:{marginTop:0}},title:!1})}]})})}),(0,M.jsx)(t.A,{span:"24",children:(0,M.jsx)(f.Ay,{style:{background:D,borderTopLeftRadius:Q,borderTopRightRadius:Q,paddingBottom:15},children:(0,M.jsxs)(d.A,{justify:"space-between",align:"middle",children:[(0,M.jsx)(t.A,{span:"1"}),(0,M.jsx)(t.A,{span:"16",children:(0,M.jsxs)(a.A,{active:!0,loading:!K&&!ee,paragraph:{rows:1},style:{marginTop:26},children:[(0,M.jsx)(d.A,{children:(0,M.jsx)(O,{children:K})}),(0,M.jsx)(d.A,{children:(0,M.jsx)($,{type:"secondary",children:ee})})]})}),(0,M.jsx)(t.A,{xs:0,md:4,children:(0,M.jsx)(d.A,{justify:"end",children:(0,M.jsx)(o.Ay,{type:"primary",htmlType:"submit",size:"large",icon:(0,M.jsx)(j.A,{}),iconPosition:"end",onClick:()=>Z(`/forum/${U}/new`),children:(0,M.jsx)(t.A,{xs:0,md:20,children:Y("pages.forum.createTopic")})})})}),(0,M.jsx)(t.A,{span:"1"})]})})}),(0,M.jsx)(t.A,{span:"24",children:(0,M.jsx)(f.Ay,{style:{background:D,borderRadius:Q},children:(0,M.jsx)(c.A,{pagination:!1,columns:Se,dataSource:ce||re&&!de?be:[...null!==se&&void 0!==se?se:[]].filter((e=>{var n;return!re||(null===de||void 0===de?void 0:de.includes(null!==(n=e.dTag)&&void 0!==n?n:""))})).slice(10*(ke-1),10*ke),onRow:(e,n)=>({onClick:()=>Z(`/topic/${e.encode()}`)})})})}),(0,M.jsx)(t.A,{span:"24",children:(0,M.jsxs)(d.A,{justify:"space-between",children:[(0,M.jsx)(o.Ay,{type:"link",disabled:ke<2,onClick:()=>we((e=>e-1)),children:Y("shared.previous")}),(0,M.jsx)(o.Ay,{type:"link",children:ke}),(0,M.jsx)(o.Ay,{type:"link",disabled:(null!==(e=null===se||void 0===se?void 0:se.size)&&void 0!==e?e:1/0)<10*ke,onClick:()=>we((e=>e+1)),children:Y("shared.next")})]})})]})}),(0,M.jsx)(t.A,{xs:24,md:7,children:(0,M.jsxs)(d.A,{gutter:[0,10],style:{marginTop:32},children:[(0,M.jsx)(t.A,{xs:0,md:24,children:(0,M.jsx)(R.G,{})}),(0,M.jsx)(t.A,{xs:0,md:24,children:(0,M.jsx)(V.O,{})}),(0,M.jsx)(t.A,{span:24,children:!s&&"all"!==U&&(0,M.jsxs)(f.Ay,{style:{padding:"24px 0",background:D,borderRadius:Q},children:[(0,M.jsx)(d.A,{justify:"space-around",children:(0,M.jsx)(t.A,{span:"16",children:(0,M.jsxs)(O,{level:2,children:[(0,M.jsx)(A.A,{}),Y("pages.forum.hotRopics")]})})}),(0,M.jsx)(d.A,{justify:"space-around",children:(0,M.jsx)(t.A,{span:"16",children:(0,M.jsxs)(a.A,{active:!0,loading:Ae,title:!1,paragraph:{rows:5},children:[[...null!==le&&void 0!==le?le:[]].map(((e,n)=>{var s,i,l,a,r;return e.tagValue("title")?(0,M.jsxs)(d.A,{justify:"space-between",onClick:()=>Z(`/topic/${e.encode()}`),children:[(0,M.jsx)(t.A,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:(0,M.jsx)(F,{strong:!0,children:null!==(s=null!==(i=e.tagValue("title"))&&void 0!==i?i:e.tagValue("d"))&&void 0!==s?s:"-"})}),(0,M.jsx)(t.A,{children:(0,M.jsx)($,{children:(0,w.m)((0,k.S)(parseInt(null!==(l=null!==(a=null===e||void 0===e?void 0:e.tagValue("published_at"))&&void 0!==a?a:null===e||void 0===e||null===(r=e.created_at)||void 0===r?void 0:r.toString())&&void 0!==l?l:"0",10)),{addSuffix:!0})})})]},n):(0,M.jsx)(M.Fragment,{})})),0===(null===le||void 0===le?void 0:le.size)?(0,M.jsx)(u.A,{image:u.A.PRESENTED_IMAGE_SIMPLE}):(0,M.jsx)(M.Fragment,{})]})})})]})}),(0,M.jsx)(t.A,{span:24,children:!s&&"all"!==U&&(0,M.jsxs)(f.Ay,{style:{padding:"24px 0",background:D,borderRadius:Q},children:[(0,M.jsx)(d.A,{justify:"space-around",children:(0,M.jsx)(t.A,{span:"16",children:(0,M.jsxs)(O,{level:2,children:[(0,M.jsx)(m.A,{}),Y("pages.forum.moderators")]})})}),(0,M.jsx)(d.A,{justify:"space-around",children:(0,M.jsx)(t.A,{span:"16",children:(0,M.jsxs)(a.A,{active:!0,loading:!q&&fe,title:!1,paragraph:{rows:3},children:[[...null!==(n=null===q||void 0===q?void 0:q.getMatchingTags("p"))&&void 0!==n?n:[]].map(((e,n)=>{var s,i;if(!e[1])return(0,M.jsx)(M.Fragment,{});const l=I[e[1]],a=new C.VT({hexpubkey:e[1]});return(0,M.jsx)(d.A,{justify:"space-between",children:(0,M.jsxs)(t.A,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:[(0,M.jsx)(h.A,{src:null===l||void 0===l?void 0:l.image,icon:(0,M.jsx)(g.A,{style:{fontSize:"20px"}})}),(0,M.jsx)(F,{strong:!0,href:`https://njump.me/${a.npub}`,target:"_blank",style:{marginLeft:5},children:null!==(s=null!==(i=null===l||void 0===l?void 0:l.name)&&void 0!==i?i:e[1])&&void 0!==s?s:"-"})]})},n)})),re?(0,M.jsx)(M.Fragment,{}):(0,M.jsx)($,{strong:!0,style:{marginLeft:5},children:Y("pages.forum.noModerators")})]})})})]})})]})})]})})}}}]);
//# sourceMappingURL=425.2c372c40.chunk.js.map